class AutocompleteHandler{constructor(e,t={},s,o={},n={}){this.inputField=e,this.objFunctions=t,this.cssId=s,this.objSettings=o,this.containerAddresses=n}setCenter(e){this.objSettings.center=e}handleInput(){const o=this;this.inputField.autocomplete({source:this.containerAddresses.arrNames});function t(e,t){var s;t=t||o,13===e.keyCode?t.objFunctions.submitFunction(e.currentTarget,e.currentTarget.classList[0]):8===e.keyCode||37<=e.keyCode&&e.keyCode<=40||9===e.keyCode||(0!=$(e.currentTarget).val().length||e.keyCode?(s=Math.floor(Date.now()),t.counter=s,setTimeout(function(){t.counter&&t.counter+400<Math.floor(Date.now())&&(delete t.counter,t.autocompleteAddress($(e.currentTarget).val(),"."+e.currentTarget.classList[0]))},500)):(t.objFunctions.deleteFunction(e.currentTarget,e.currentTarget.classList[0]),-1!=(s=e.currentTarget.classList[0]).indexOf("from")?(t.containerAddresses.arrFromPositions=[],t.containerAddresses.arrFromPositions=[]):-1!=s.indexOf("to")?(t.containerAddresses.arrToNames=[],t.containerAddresses.arrToPositions=[]):console.log("This is weird")))}this.inputField.on("keydown",e=>t(e,o)),this.inputField.on("search",t),this.inputField.on("autocompleteselect",this.objFunctions.selectListener),this.inputField.on("change",this.objFunctions.changeListener)}autocompleteAddress(e,c){const l=this;let t;var s;l.objSettings.center?t="function"==typeof l.objSettings.center?(s=l.objSettings.center())[0]+","+s[1]:l.objSettings.center[0]+","+l.objSettings.center[1]:l.objSettings.bBox&&(t=(parseFloat(l.objSettings.bBox[0])+parseFloat(l.objSettings.bBox[2]))/2+","+(parseFloat(l.objSettings.bBox[1])+parseFloat(l.objSettings.bBox[3]))/2);let o;if(o=t?l.objSettings.proxyUrl+"autocomplete.php?format=json&key="+l.objSettings.keyAutocomplete+"&q="+e+"&center="+t:l.objSettings.proxyUrl+"autocomplete.php?format=json&key="+l.objSettings.keyAutocomplete+"&q="+e,this.objSettings.autoLength&&(o+="&limit="+this.objSettings.autoLength),this.objSettings.geosearchParams)for(var n in this.objSettings.geosearchParams)this.objSettings.geosearchParams.hasOwnProperty(n)&&(o+="&"+n+"="+this.objSettings.geosearchParams[n]);$.ajax({url:o}).done(function(e){let t;if(l.objSettings.center?t=l.objSettings.center:l.objSettings.bBox&&(t=[(parseFloat(l.objSettings.bBox[0])+parseFloat(l.objSettings.bBox[2]))/2,(parseFloat(l.objSettings.bBox[1])+parseFloat(l.objSettings.bBox[3]))/2]),0<e.length){if(e[0]&&e[0].display_name&&t){var s,o,n,r=[];for(s in e)e.hasOwnProperty(s)&&l.objSettings.bBox&&l.objSettings.bBox[0]&&l.isInBoundingBox(e[s].lon,e[s].lat,l.objSettings.bBox)&&(o={dist:Math.sqrt((t[0]-e[s].lon)*(t[0]-e[s].lon)+(t[1]-e[s].lat)*(t[1]-e[s].lat)),pos:[e[s].lat,e[s].lon],name:e[s].display_name},r.push(o));for(n in r.sort((e,t)=>e.dist-t.dist),r)r.hasOwnProperty(n)&&(-1!=c.indexOf("from")?l.containerAddresses.arrFromNames.includes(r[n].name)||(l.containerAddresses.arrFromNames.push(r[n].name),l.containerAddresses.arrFromPositions.push(r[n].pos)):-1!=c.indexOf("to")?l.containerAddresses.arrToNames.includes(r[n].name)||(l.containerAddresses.arrToNames.push(r[n].name),l.containerAddresses.arrToPositions.push(r[n].pos)):console.log("This is weird"));var i=jQuery.Event("keydown",{keyCode:8});$(c).trigger(i)}else for(var a in e){var d;e.hasOwnProperty(a)&&(-1!=c.indexOf("from")?l.containerAddresses.arrFromNames.includes(e[a].display_name)||(l.containerAddresses.arrFromNames.push(e[a].display_name),l.containerAddresses.arrFromPositions.push([e[a].lat,e[a].lon])):-1!=c.indexOf("to")?l.containerAddresses.arrToNames.includes(e[a].display_name)||(l.containerAddresses.arrToNames.push(e[a].display_name),l.containerAddresses.arrToPositions.push([e[a].lat,e[a].lon])):-1!=c.indexOf("over")?(d=c[c.length-1],l.containerAddresses.arrOverNames[d].includes(e[a].display_name)||(l.containerAddresses.arrOverNames[d].push(e[a].display_name),l.containerAddresses.arrOverPositions[d].push([e[a].lat,e[a].lon]))):console.log("This is weird"))}i=jQuery.Event("keydown",{keyCode:8});$(c).trigger(i)}})}isInBoundingBox(e,t,s){return"string"==typeof e&&(e=parseFloat(e)),"string"==typeof t&&(t=parseFloat(t)),s[0]<e&&e<s[2]&&s[1]<t&&t<s[3]}}export{AutocompleteHandler};