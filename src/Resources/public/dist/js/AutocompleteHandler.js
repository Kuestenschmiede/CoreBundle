class AutocompleteHandler{constructor(e,s={},t,o={},n={}){this.inputField=e,this.objFunctions=s,this.cssId=t,this.objSettings=o,this.containerAddresses=n}setCenter(e){this.objSettings.center=e}handleInput(){function s(e,s){var t;s=s||o,13===e.keyCode?s.objFunctions.submitFunction(e.currentTarget,e.currentTarget.classList[0]):8===e.keyCode||37<=e.keyCode&&e.keyCode<=40||9===e.keyCode||(0!=$(e.currentTarget).val().length||e.keyCode?(t=Math.floor(Date.now()),s.counter=t,setTimeout(function(){s.counter&&s.counter+400<Math.floor(Date.now())&&(delete s.counter,s.autocompleteAddress($(e.currentTarget).val(),"."+e.currentTarget.classList[0]))},500)):(s.objFunctions.deleteFunction(e.currentTarget,e.currentTarget.classList[0]),-1!=(t=e.currentTarget.classList[0]).indexOf("from")?(s.containerAddresses.arrFromPositions=[],s.containerAddresses.arrFromPositions=[]):-1!=t.indexOf("to")?(s.containerAddresses.arrToNames=[],s.containerAddresses.arrToPositions=[]):console.log("This is weird")))}let o=this;this.inputField.autocomplete({source:this.containerAddresses.arrNames});this.inputField.on("keydown",e=>s(e,o)),this.inputField.on("search",s),this.inputField.on("autocompleteselect",this.objFunctions.selectListener),this.inputField.on("change",this.objFunctions.changeListener)}autocompleteAddress(e,l){let u=this,s;var t;u.objSettings.center?s="function"==typeof u.objSettings.center?(t=u.objSettings.center())[0]+","+t[1]:u.objSettings.center[0]+","+u.objSettings.center[1]:u.objSettings.bBox&&(s=(parseFloat(u.objSettings.bBox[0])+parseFloat(u.objSettings.bBox[2]))/2+","+(parseFloat(u.objSettings.bBox[1])+parseFloat(u.objSettings.bBox[3]))/2);let o;if(o=s?u.objSettings.proxyUrl+"autocomplete.php?format=json&key="+u.objSettings.keyAutocomplete+"&q="+e+"&center="+s:u.objSettings.proxyUrl+"autocomplete.php?format=json&key="+u.objSettings.keyAutocomplete+"&q="+e,this.objSettings.autoLength&&(o+="&limit="+this.objSettings.autoLength),this.objSettings.geosearchParams)for(var n in this.objSettings.geosearchParams)this.objSettings.geosearchParams.hasOwnProperty(n)&&(o+="&"+n+"="+this.objSettings.geosearchParams[n]);$.ajax({url:o}).done(function(e){let s;if(u.objSettings.center?s=u.objSettings.center:u.objSettings.bBox&&(s=[(parseFloat(u.objSettings.bBox[0])+parseFloat(u.objSettings.bBox[2]))/2,(parseFloat(u.objSettings.bBox[1])+parseFloat(u.objSettings.bBox[3]))/2]),0<e.length){if(e[0]&&e[0].display_name&&s){var t,o,n,r,i=[];for(t in e)e.hasOwnProperty(t)&&u.objSettings.bBox&&u.objSettings.bBox[0]&&u.isInBoundingBox(e[t].lon,e[t].lat,u.objSettings.bBox)&&(o={dist:Math.sqrt((s[0]-e[t].lon)*(s[0]-e[t].lon)+(s[1]-e[t].lat)*(s[1]-e[t].lat)),pos:[e[t].lat,e[t].lon],name:e[t].display_name},i.push(o));for(n in i.sort((e,s)=>e.dist-s.dist),i)i.hasOwnProperty(n)&&(-1!=l.indexOf("from")?u.containerAddresses.arrFromNames.includes(i[n].name)||(u.containerAddresses.arrFromNames.push(i[n].name),u.containerAddresses.arrFromPositions.push(i[n].pos)):-1!=l.indexOf("to")?u.containerAddresses.arrToNames.includes(i[n].name)||(u.containerAddresses.arrToNames.push(i[n].name),u.containerAddresses.arrToPositions.push(i[n].pos)):-1!=l.indexOf("over")?(r=l[l.length-1],u.containerAddresses.arrOverNames[r].includes(i[n].name)||(u.containerAddresses.arrOverNames[r].push(i[n].name),u.containerAddresses.arrOverPositions[r].push(i[n].pos))):console.log("This is weird"));var a=jQuery.Event("keydown",{keyCode:8});$(l).trigger(a)}else for(var d in e){var c;e.hasOwnProperty(d)&&(-1!=l.indexOf("from")?u.containerAddresses.arrFromNames.includes(e[d].display_name)||(u.containerAddresses.arrFromNames.push(e[d].display_name),u.containerAddresses.arrFromPositions.push([e[d].lat,e[d].lon])):-1!=l.indexOf("to")?u.containerAddresses.arrToNames.includes(e[d].display_name)||(u.containerAddresses.arrToNames.push(e[d].display_name),u.containerAddresses.arrToPositions.push([e[d].lat,e[d].lon])):-1!=l.indexOf("over")?(c=l[l.length-1],u.containerAddresses.arrOverNames[c].includes(e[d].display_name)||(u.containerAddresses.arrOverNames[c].push(e[d].display_name),u.containerAddresses.arrOverPositions[c].push([e[d].lat,e[d].lon]))):console.log("This is weird"))}a=jQuery.Event("keydown",{keyCode:8});$(l).trigger(a)}})}isInBoundingBox(e,s,t){return"string"==typeof e&&(e=parseFloat(e)),"string"==typeof s&&(s=parseFloat(s)),t[0]<e&&e<t[2]&&t[1]<s&&s<t[3]}}export{AutocompleteHandler};